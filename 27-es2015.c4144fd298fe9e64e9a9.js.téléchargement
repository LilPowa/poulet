(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{"1cRO":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r("AytR"),s=r("fXoL"),n=r("tk/3");let a=(()=>{class e{constructor(e){this.http=e}logInfo(e){return this.http.post(i.a.apiUrlInternal+"uiloginfo",JSON.stringify({error:"Info",message:"UI - "+e}))}logError(e,t){return this.http.post(i.a.apiUrlInternal+"uiloginfo",JSON.stringify({error:e,message:"UI - "+t}))}logErrorInOpenBasket(e,t,r){return this.http.post(i.a.apiUrlInternal+`logerror/${e}/${t}`,JSON.stringify({error:"Payment",message:r}))}}return e.\u0275fac=function(t){return new(t||e)(s.ec(n.b))},e.\u0275prov=s.Kb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},J8yP:function(e,t,r){"use strict";r.d(t,"a",(function(){return p}));var i=r("lJxs"),s=r("j6FD"),n=r("vVw+"),a=r("BOF4"),o=r("MsxC"),c=r("AytR"),u=r("pCEw"),h=r("fXoL"),d=r("tk/3"),l=r("tyNb");let p=(()=>{class e{constructor(e,t,r,i,s){this.http=e,this.storageService=t,this.authenticationService=r,this.router=i,this.basketService=s}get guestCustomerData(){return this.guestCustomerDetails}set guestCustomerData(e){this.guestCustomerDetails=e}resetPassword(e){return this.http.post(c.a.apiUrlInternal+"users/"+this.authenticationService.currentUserValue.id+"/resetpassword",JSON.stringify(e))}getUserDetails(){return this.http.get(c.a.apiUrlInternal+"users/"+this.authenticationService.currentUserValue.id)}updateUserDetails(e){var t=this.authenticationService.currentUserValue.id;if(this.authenticationService.isLoggedIn())return this.http.post(c.a.apiUrlInternal+"users/"+t,JSON.stringify(e)).pipe(Object(i.a)(e=>(e.token&&(this.storageService.saveToken(e.token),this.authenticationService.currentUserSubject.next(this.getUser())),e)));this.authenticationService.logout(),this.basketService.clearBasket(),localStorage.removeItem("explicationModal"),this.router.navigate(["/mon-compte/connexion"],{queryParams:{returnUrl:this.router.url}})}getTokenExpirationDate(e){const t=a(e);if(void 0===t.exp)return null;const r=new Date(0);return r.setUTCSeconds(t.exp),r}isTokenExpired(e){if(e||(e=this.storageService.getToken()),!e)return!0;const t=this.getTokenExpirationDate(e);return void 0!==t&&!(t.valueOf()>(new Date).valueOf())}getUser(){let e;if(this.storageService.getToken())if(this.isTokenExpired())this.storageService.signOut();else{const t=a(this.storageService.getToken());t&&(e=new s.a,e.id=t.Id,e.firstName=t.FirstName,e.lastname=t.LastName,e.email=t.Email,e.phoneNumber=t.PhoneNumber)}return e}getAddressDetails(){return this.http.get(c.a.apiUrlInternal+"users/"+this.authenticationService.currentUserValue.id+"/addresses")}getPastOrders(){return this.http.get(c.a.apiUrlInternal+"users/"+this.authenticationService.currentUserValue.id+"/pastorders")}getReceiptForPastOrders(e){return this.http.get(c.a.apiUrlInternal+"order/"+e+"/generateReceipt")}getFavoriteOrders(){return this.http.get(c.a.apiUrlInternal+"users/"+this.authenticationService.currentUserValue.id+"/favoriteorders")}getSavedCards(){return this.http.get(c.a.apiUrlInternal+"users/"+this.authenticationService.currentUserValue.id+"/creditcards")}getStripeSavedCards(){return this.http.get(c.a.apiUrlInternal+"users/"+this.authenticationService.currentUserValue.id+"/stripecreditcards")}saveFavoriteOrder(e,t){return this.http.post(c.a.apiUrlInternal+"users/"+this.authenticationService.currentUserValue.id+"/favoriteorders",JSON.stringify({name:e,orderTrackerId:t}))}deleteAccount(){return this.http.post(c.a.apiUrlInternal+"users/"+this.authenticationService.currentUserValue.id+"/delete",null)}deleteAddress(e){return this.http.post(c.a.apiUrlInternal+"users/"+this.authenticationService.currentUserValue.id+"/addresses/"+e+"/delete",null)}deleteFavoriteOrder(e){return this.http.post(c.a.apiUrlInternal+"users/"+this.authenticationService.currentUserValue.id+"/favoriteorders/"+e+"/delete",null)}deleteCard(e){return this.http.post(c.a.apiUrlInternal+"users/"+this.authenticationService.currentUserValue.id+"/creditcards/"+e+"/delete",null)}registerColonelsClub(e,t){return e.recaptchaToken=t,this.http.post(c.a.apiUrlInternal+"registercolonelclub",JSON.stringify(e))}updateRestaurant(e){return this.http.post(c.a.apiUrlInternal+"users/"+this.authenticationService.currentUserValue.id+"/restaurants",JSON.stringify(e))}deleteRestaurant(e){return this.http.post(c.a.apiUrlInternal+"users/"+this.authenticationService.currentUserValue.id+"/restaurantname/"+e+"/delete",null)}}return e.\u0275fac=function(t){return new(t||e)(h.ec(d.b),h.ec(n.a),h.ec(o.a),h.ec(l.e),h.ec(u.a))},e.\u0275prov=h.Kb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},Yuqk:function(e,t,r){"use strict";r.r(t),r.d(t,"ProcessOrderModule",(function(){return w}));var i,s,n,a=r("ofXK"),o=r("tyNb"),c=r("pCEw"),u=r("3st6"),h=r("MsxC"),d=r("YXjc"),l=r("zx3v"),p=r("J8yP"),m=r("fFWf"),g=r("Ki4z"),b=r("1cRO"),v=r("fXoL"),k=r("tk/3"),f=r("jCJ1");function S(e,t){1&e&&(v.Ub(0,"div"),v.Ub(1,"h1"),v.Yb(2,s),v.Tb(),v.Tb())}function O(e,t){1&e&&(v.Ub(0,"div"),v.Ub(1,"h1"),v.Yb(2,n),v.Tb(),v.Tb())}i="VEUILLEZ NE PAS ACTUALISER VOTRE PAGE NI CLIQUER SUR LE BOUTON \"RETOUR\" DU NAVIGATEUR.",s="\n          Un instant s'il vous pla\xEEt\n        ",n="\n          Commande re\xE7ue\n        ";const I=function(e){return{active:e}};function C(e,t){if(1&e&&(v.Ub(0,"section",1),v.Lc(1,S,3,0,"div",2),v.Lc(2,O,3,0,"div",2),v.Ub(3,"div",3),v.Pb(4,"div",4),v.Pb(5,"div",5),v.Tb(),v.Ub(6,"h1"),v.Yb(7,i),v.Tb(),v.Tb()),2&e){const e=v.mc();v.Bb(1),v.rc("ngIf",!e.orderProcessed),v.Bb(1),v.rc("ngIf",e.orderProcessed),v.Bb(1),v.rc("ngClass",v.vc(3,I,e.orderProcessed))}}const y=[{path:"",component:(()=>{class e{constructor(e,t,r,i,s,n,a,o,c,u,h,d){this.checkoutService=e,this.basketService=t,this.authenticationService=r,this.router=i,this.gtmService=s,this.constants=n,this.userService=a,this.http=o,this.recaptchaV3Service=c,this.brazeService=u,this.locationService=h,this.loggerService=d}ngOnDestroy(){this.updateBasketSubscription&&this.updateBasketSubscription.unsubscribe(),this.checkoutSubscription&&this.checkoutSubscription.unsubscribe()}ngOnInit(){var e=this.checkoutService.checkOutData,t=this.basketService.currentBasketDetails,r=this.locationService.locationDetails;e.existingCard=this.checkoutService.existingCard,this.checkoutService.existingCard&&(this.checkoutService.checkOutData.saveCard=!1),this.isSaveCard=this.checkoutService.checkOutData.saveCard,this.checkoutService.checkOutData.customerId&&(this.customerId=this.checkoutService.checkOutData.customerId),e&&t?(this.orderProcessing=!0,JSON.stringify(e.customer)&&(e.customer.password=""),r&&(e.posType=r.selectedStore.web.posType),this.initiateSubmitOrder(t,e)):this.router.navigate(["/"])}initiateSubmitOrder(e,t){this.updateBasketSubscription=this.basketService.updateBasket(t).subscribe(r=>{this.submitOrder(e,t)},e=>{this.checkoutService.error=e.error,this.router.navigate(["/paiement"])})}submitOrder(e,t){this.stripeObj=Stripe(this.checkoutService.getstripePublishableKey),t&&!t.savedCardId&&(t.saveCard=!1),this.recaptchaV3Service.execute("submitOrder").subscribe(r=>{this.recaptchav3_token=r,this.checkoutSubscription=this.checkoutService.submitOrder(e.id,t,this.recaptchav3_token).subscribe(t=>{t&&"requires_action"===t.status?this.stripeObj.handleCardAction(t.clientSecret).then(r=>{r.error?(this.loggerService.logInfo(`Stripe handle card action failed for basket id - ${e.id} with error code : ${r.error.code} , message : ${r.error.message}`).subscribe(),this.loggerService.logErrorInOpenBasket(e.id,t.paymentReference,"payment_intent_authentication_failure").subscribe(),this.checkoutService.error=r.error,this.router.navigate(["/paiement"])):(this.loggerService.logInfo("Stripe handle card action success for basket id - "+e.id).subscribe(),this.checkoutService.checkOutData.PaymentIntentId=r.paymentIntent.id,this.checkoutService.checkOutData.PaymentReference=t.paymentReference,this.customerId&&t.customerId&&this.customerId===t.customerId?(this.checkoutService.checkOutData.customerId=this.customerId,this.checkoutService.checkOutData.IsNewCustomer=!1):t.customerId&&(this.checkoutService.checkOutData.customerId=t.customerId,this.checkoutService.checkOutData.IsNewCustomer=!0),this.router.navigate(["/processpayment"]))}):t&&t.orderIdTracker&&t.orderNumber?(this.gtmService.checkoutProgressStep4(),this.gtmService.purchase(t.orderNumber),this.brazeService.logPurchase(t.orderNumber,"Web"),this.orderProcessed=!0,this.basketService.clearBasket(),localStorage.setItem(this.constants.ORDER_TRAKING_ID,t.orderNumber),this.checkoutService.checkOutData.customerId||(this.userService.guestCustomerData=this.checkoutService.checkOutData.customer),this.checkoutService.checkOutData=null,this.loggerService.logInfo(`Submit Order- Order submitted successfully for basket id -${e.id} , OrderTrackerNumber - ${t.orderNumber}`).subscribe(),setTimeout(()=>{this.router.navigate(["/confirmation-de-commande/"+t.orderIdTracker])},2e3)):(this.loggerService.logInfo("Order submission failed for basket id -"+e.id).subscribe(),this.checkoutService.error=this.constants.GENERIC_ERROR,this.router.navigate(["/paiement"]))},t=>{this.loggerService.logInfo(`Order submission failed for basket id -${e.id} with error ${JSON.stringify(t)}`).subscribe(),this.checkoutService.error=t.error,this.router.navigate(["/paiement"])})})}postPaymentRequest(){const e=document.createElement("form");e.method="post",e.action=this.paymentUrl;const t=document.createElement("input");document.createElement("input"),t.type="hidden",t.name="MD",t.value=this.paymentTransactionData,e.appendChild(t);const r=document.createElement("input");document.createElement("input"),r.type="hidden",r.name="PaReq",r.value=this.paymentAuthReq,e.appendChild(r);const i=document.createElement("input");document.createElement("input"),i.type="hidden",i.name="TermUrl",i.value=this.termUrl+"?receiptId="+this.receiptId+"&basketId="+this.basketId,e.appendChild(i),document.body.appendChild(e),e.submit()}}return e.\u0275fac=function(t){return new(t||e)(v.Ob(u.a),v.Ob(c.a),v.Ob(h.a),v.Ob(o.e),v.Ob(d.a),v.Ob(l.a),v.Ob(p.a),v.Ob(k.b),v.Ob(f.d),v.Ob(m.a),v.Ob(g.a),v.Ob(b.a))},e.\u0275cmp=v.Ib({type:e,selectors:[["app-process-order"]],decls:1,vars:1,consts:[["class","container page-wrapper order-proccessing-block",4,"ngIf"],[1,"container","page-wrapper","order-proccessing-block"],[4,"ngIf"],[1,"custom-loader",3,"ngClass"],[1,"loader"],[1,"checkmark"]],template:function(e,t){1&e&&v.Lc(0,C,8,5,"section",0),2&e&&v.rc("ngIf",t.orderProcessing)},directives:[a.l,a.j],styles:['.custom-loader[_ngcontent-%COMP%]{margin:0 auto 1.4285714286rem}.custom-loader[_ngcontent-%COMP%], .custom-loader[_ngcontent-%COMP%]   .loader[_ngcontent-%COMP%]{width:10em;height:10em;position:relative}.custom-loader[_ngcontent-%COMP%]   .loader[_ngcontent-%COMP%]{margin-bottom:5em;border:8px solid rgba(0,0,0,.2);border-left-color:#e4002b;animation:loader-spin 1.2s linear infinite;display:inline-block;vertical-align:top;border-radius:50%}.custom-loader[_ngcontent-%COMP%]   .checkmark[_ngcontent-%COMP%]{position:absolute;top:4px;display:none}.custom-loader[_ngcontent-%COMP%]   .checkmark[_ngcontent-%COMP%]:after{opacity:1;height:5em;width:2.5em;-ms-transform-origin:left top;transform-origin:left top;border-right:8px solid #e4002b;border-top:8px solid #e4002b;content:"";left:2.5em;top:5em;position:absolute}.custom-loader.active[_ngcontent-%COMP%]   .loader[_ngcontent-%COMP%]{animation:none;border-color:#e4002b;transition:border .5s ease-out}.custom-loader.active[_ngcontent-%COMP%]   .checkmark[_ngcontent-%COMP%]{display:block}.custom-loader.active[_ngcontent-%COMP%]   .checkmark[_ngcontent-%COMP%]:after{animation-duration:.8s;animation-timing-function:ease;animation-name:checkmark;-ms-transform:scaleX(-1) rotate(135deg);transform:scaleX(-1) rotate(135deg)}@keyframes checkmark{0%{height:0;width:0;opacity:1}20%{height:0;width:2.5em;opacity:1}40%{height:5em;width:2.5em;opacity:1}to{height:5em;width:2.5em;opacity:1}}@keyframes loader-spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.order-proccessing-block[_ngcontent-%COMP%]{padding-top:6.4285714286rem;min-height:500px}.order-proccessing-block[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{text-align:center;font-family:National2Condensed-Bold;margin-bottom:1.4285714286rem;text-transform:uppercase;font-size:2.5714285714rem;line-height:36px}.order-proccessing-block[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:center}.order-proccessing-block[_ngcontent-%COMP%]   .custom-loader[_ngcontent-%COMP%]{margin-top:2.8571428571rem;margin-bottom:3.5714285714rem}@media (min-width:768px){.order-proccessing-block[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.2857142857rem}}@media (min-width:768px){.order-proccessing-block[_ngcontent-%COMP%]{padding-top:10.7142857143rem}}']}),e})()}];let U=(()=>{class e{}return e.\u0275mod=v.Mb({type:e}),e.\u0275inj=v.Lb({factory:function(t){return new(t||e)},imports:[[o.i.forChild(y)],o.i]}),e})();var P=r("PCNd");let w=(()=>{class e{constructor(e,t){this.router=t}}return e.\u0275mod=v.Mb({type:e}),e.\u0275inj=v.Lb({factory:function(t){return new(t||e)(v.ec(f.h,8),v.ec(o.e))},imports:[[a.b,U,P.a,f.h?f.h:null]]}),e})()}}]);